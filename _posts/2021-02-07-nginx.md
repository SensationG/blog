---
layout: post
title: nginxé…ç½®
date: 2021-02-07
Author: hhw
toc: true
comments: true
tags:  [nginx]

---

### ä¸€ã€å‰åç«¯åˆ†ç¦»ä»£ç†é…ç½®

åœ¨è¿›è¡Œå‰åç«¯åˆ†ç¦»é¡¹ç›®æ—¶ï¼Œä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œè¿™æ—¶æˆ‘ä»¬ä½¿ç”¨nginxå»ä»£ç†è®¿é—®å°±å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜

è¿™é‡Œé‡‡ç”¨æ–°å¢é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œä¸å¯¹åŸç”Ÿé…ç½®æ–‡ä»¶è¿›è¡Œå¤§æ”¹åŠ¨ï¼Œåªéœ€åœ¨åŸé…ç½®æ–‡ä»¶é‡ŒåŠ å…¥includeå»è¯»æŒ‡å®šç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶å³å¯ï¼Œå¦‚ä¸‹

```js
http {
    	include       mime.types;
    	default_type  application/octet-stream;
    	log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    
    	sendfile  on;
    	tcp_nopush on;
    	tcp_nodelay on;
        client_max_body_size    2000m;
    	server_names_hash_bucket_size 128;
    	keepalive_timeout 60;
        client_header_timeout 60; 
        client_body_timeout 60; 
        send_timeout 60;
        client_header_buffer_size    10m;
        large_client_header_buffers  4 10m;
	gzip on;
	gzip_min_length 1k;
	gzip_buffers 16 64k;
	gzip_http_version 1.1;
	gzip_comp_level 6;
	gzip_types text/plain application/x-javascript text/css application/xml;
	gzip_vary on;
	server {
		listen  80  default;
		server_name  _;
		return 444;
	    }
	// åœ¨è¿™é‡Œé…ç½®å»è¯»åŒºæŒ‡å®šç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶
	include C:/TRT/nginx/conf/vhosts/*.conf;
}
```

åœ¨ğŸ‘†ä¸Šé¢æŒ‡å®šè¯»å–çš„é…ç½®æ–‡ä»¶åï¼Œæ–°å¢ä¸€ä¸ªxxxx.confæ–‡ä»¶è¿›è¡Œé…ç½®

#### å‰åç«¯é…ç½®

```js
server {
  	# ç«¯å£
    listen 80; 
  	# æŒ‡å®šserver name
    server_name www.aiyuxingfu.cn;
    error_log logs/aiyuxingfu.cn.log warn;
    access_log logs/aiyuxingfu.cn.access.log;
    client_max_body_size 300m;
    client_header_buffer_size 10m;
    large_client_header_buffers 4 10m;
    client_body_buffer_size 10m;
	
  # è·³è½¬åˆ°https å³ä¸‹é¢é…ç½®éƒ½ä¸ä¼šå¯ç”¨ ä¼šè·³è½¬åˆ° 443ç«¯å£çš„é…ç½®
	rewrite ^(.*)$ https://$host$1 permanent;
	#rewrite ^(.*)$ https://aiyuxingfu.cn:443/$1 permanent;
	
	location / {
	   root www;
	}
	
  location /console/ {
    # æŒ‡å®šè·³è½¬é¦–é¡µ
    if (!-e $request_filename) {
      rewrite ^(.*)$ /console/index.html?c=$1 last;
      break;
    }
      # å‰ç«¯é¡¹ç›®åŒ…æ‰€åœ¨è·¯å¾„
      alias  C:/TRT/TRTPROJECT/console-ui/;
  }
	
	location /project/ {
		if (!-e $request_filename) {
			rewrite ^(.*)$ /project/index.html?p=$1 last;
			break;
		}
        alias  C:/TRT/TRTPROJECT/project-ui/;
   }
		
   # åç«¯ä»£ç†è·¯å¾„
	 location /prod-api/ {
        proxy_pass http://127.0.0.1:8080;
   }

}

```

### äºŒã€é…ç½®HTTPS

æŒ‡å®šè·³è½¬åˆ°httpsç«¯å£åï¼Œä½¿ç”¨ä»¥ä¸‹é…ç½®æ–‡ä»¶

è¯¥æ¡ˆä¾‹é‡‡ç”¨é˜¿é‡Œäº‘sslè¯ä¹¦ï¼Œè¯ä¹¦å’Œå¯†é’¥ä»é˜¿é‡Œäº‘è¿›è¡Œä¸‹è½½ï¼Œæ”¾ç½®åœ¨nginxçš„confç›®å½•-æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å­˜æ”¾å¯†é’¥

```js
server {
    listen 443; 
    server_name www.aiyuxingfu.cn;
  	# æ ¹æ®nginxç‰ˆæœ¬å†³å®šæ˜¯å¦è®¾ç½®on
		ssl on;
	
  # é…ç½®sslè¯ä¹¦
	ssl_certificate cert/4566504_aiyuxingfu.cn.pem;
  # è¯ä¹¦éšé™„å¯†é’¥
	ssl_certificate_key cert/4566504_aiyuxingfu.cn.key;
	
  	# 13-16è¡Œå‚ç…§é˜¿é‡Œäº‘æ–‡æ¡£å¡«å†™
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_prefer_server_ciphers on;
	
    # 19-24è¡Œå‚ç…§trtå¡«å†™ 
    error_log logs/aiyuxingfu.cn.log warn;
    access_log logs/aiyuxingfu.cn.access.log;
    client_max_body_size 300m;
    client_header_buffer_size 10m;
    large_client_header_buffers 4 10m;
    client_body_buffer_size 10m;
	
	
	location / {
	    rewrite ^(.*)$ /project/index.html?p=$1;
	}
	
  location /console/ {
    if (!-e $request_filename) {
      rewrite ^(.*)$ /console/index.html?c=$1 last;
      break;
    }
  	alias  C:/TRT/TRTPROJECT/console-ui/;
  }
	
	location /project/ {
		if (!-e $request_filename) {
			rewrite ^(.*)$ /project/index.html?p=$1 last;
			break;
		}
        alias  C:/TRT/TRTPROJECT/project-ui/;
   }
    
	
	location /prod-api/ {
        proxy_pass http://127.0.0.1:8080;
   }

}

```

