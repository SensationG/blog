---
layout: post
title: v-viewerè‡ªå®šä¹‰ä½¿ç”¨æŒ‡å—
date: 2020-12-07
Author: hhw
toc: true
comments: true
tags:  [å‰ç«¯,viewer]
---

## v-viewerè‡ªå®šä¹‰ä½¿ç”¨

- v-viewerç®€ä»‹

  ç”¨äºå›¾ç‰‡æµè§ˆçš„Vueç»„ä»¶ï¼Œæ”¯æŒæ—‹è½¬ã€ç¼©æ”¾ã€ç¿»è½¬ç­‰æ“ä½œï¼ŒåŸºäº[viewer.js](https://github.com/fengyuanchen/viewerjs)ã€‚

- [APIæ–‡æ¡£](https://github.com/fengyuanchen/viewerjs)  [ä¸­æ–‡æ–‡æ¡£](https://mirari.cc/2017/08/27/Vue%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E7%BB%84%E4%BB%B6v-viewer%EF%BC%8C%E6%94%AF%E6%8C%81%E6%97%8B%E8%BD%AC%E3%80%81%E7%BC%A9%E6%94%BE%E3%80%81%E7%BF%BB%E8%BD%AC%E7%AD%89%E6%93%8D%E4%BD%9C/)

- éœ€æ±‚å¦‚ä¸‹ï¼š

  ç‚¹å‡»æŒ‰é’®è¿›å…¥v-vieweré¢„è§ˆæ¨¡å¼

  ç‚¹å‡»å›¾ç‰‡è¿›å…¥v-vieweré¢„è§ˆæ¨¡å¼

  è‡ªå®šä¹‰v-viewerä¸­çš„toolbarå·¥å…·æ æŒ‰é’®ï¼Œä½¿å¾—å¯ä»¥å¯¹è‡ªå¸¦æŒ‰é’®è¿›è¡Œç›‘å¬å’Œå¢åŠ è‡ªå®šä¹‰æŒ‰é’®

- æœ¬demoåŸºäº vue 2.x

### ä¸€ã€å®‰è£…

ä½¿ç”¨ npm å‘½ä»¤å®‰è£…

```bash
npm install v-viewer
```

### äºŒã€å¼•å…¥

å¯ä»¥é€‰æ‹©å…¨å±€å¼•å…¥ï¼ˆåœ¨main.jsï¼‰æˆ–å±€éƒ¨å¼•å…¥ï¼Œè¿™é‡Œä»¥å±€éƒ¨å¼•å…¥ä¸ºä¾‹ï¼š

```js
import 'viewerjs/dist/viewer.css'
import Viewer from 'v-viewer'
import Vue from 'vue'
Vue.use(Viewer)
```

### ä¸‰ã€ä½¿ç”¨

è¿™é‡Œéƒ½ä»¥æŒ‡ä»¤æ–¹å¼ä½¿ç”¨ä¸ºä¾‹

#### 1.buttonè¿›å…¥

å¼•å…¥vieweråï¼Œå°±å¯ä»¥æ„‰å¿«çš„å¼€å§‹ä½¿ç”¨äº†ï¼Œ

è¿™é‡Œå…ˆä»¥ç‚¹å‡»æŒ‰é’®è¿›å…¥viewerä¸ºä¾‹ï¼š

**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæŒ‰é’®**

```js
<el-button type="primary" @click="show">å¤§å›¾æ¨¡å¼</el-button>
```

**ç¬¬äºŒæ­¥ï¼šè®¾ç½®éœ€è¦è¢«viewerå¤„ç†çš„å›¾ç‰‡**

è®¾ç½®éšè—æ ‡ç­¾ï¼Œä»…ä¾›ç‚¹å‡»æŒ‰é’®ä½¿ç”¨ï¼Œå¹³å¸¸çœ‹ä¸è§ï¼š

<u>è®¾ç½®v-vieweråï¼Œè¯¥å…ƒç´ ä¸‹çš„æ‰€æœ‰imgå…ƒç´ éƒ½ä¼šè¢«viewerè‡ªåŠ¨å¤„ç†</u>

```html
<!-- éšè— å¤§å›¾æ¨¡å¼ä½¿ç”¨ è®¾ç½®v-vieweråï¼Œè¯¥å…ƒç´ ä¸‹çš„æ‰€æœ‰imgå…ƒç´ éƒ½ä¼šè¢«viewerè‡ªåŠ¨å¤„ç† -->
<div class="images" id="image" v-viewer v-show="false">
    <div v-for="photo in pictures" data-photoid="photo.photoId">
      <img :src="photo.response.url" >
    </div>
</div>
```

**ç¬¬ä¸‰æ­¥ï¼šé…ç½®vieweré»˜è®¤æŒ‰é’®ä»¥åŠæŒ‰é’®ç›‘å¬ï¼ˆæ ¸å¿ƒï¼‰**

åœ¨exportå¤–éƒ¨

```js
<script>
//.... è¿™é‡Œéœ€è¦å¼•å…¥viewer å‚è§ä¸Šé¢
// é…ç½®viewerå¯ä»¥è§æ–‡ç« å¼€å¤´çš„githubğŸ”—
Viewer.setDefaults({
  zIndex: 1000,
  toolbar: {
    zoomIn: 1,
    zoomOut: 1,
    oneToOne: 1,
    rotateLeft: 1,
    rotateRight: 1,
    flipHorizontal: 1,
    reset: 1,
    prev: {
      show: 1,
      // ä¸Šä¸€å¼ ç‚¹å‡»äº‹ä»¶
      click: () => {
        vm.handleViewerPrev()
      }
    },
    next: {
      show: 1,
      // ä¸‹ä¸€å¼ ç‚¹å‡»äº‹ä»¶
      click: () => {
        vm.handleViewerNext()
      }
    },
    // è‡ªå®šä¹‰æ–¹æ³•
    score() {
      // åœ¨é‡Œé¢å¯ä»¥è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç† è¿™é‡Œçœç•¥æ–¹æ³•å®ç°
      if (!vm.viewerScoreStatus) {
        vm.handleViewerAddScore()
      } else {
        vm.handleViewerCancelScore()
      }
    }
  }
})

// åœ¨createdæ–¹æ³•ä¸­è®¾ç½®vm=this ä»¥æ­¤è®©exportå¤–çš„æ–¹æ³•å¯ä»¥è°ƒç”¨exportå†…çš„æ–¹æ³•
let vm = null

</script>
```

exportå†…çš„æ–¹æ³•ï¼š

é‡ç‚¹ï¼šè·å–viewerå½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡ä¸‹æ ‡

 `const viewer = this.$el.querySelector('.images').$viewer    let index = viewer.index`

```js
// å±•ç¤ºå¤§å›¾æŒ‰é’®æ–¹æ³•
show (index) {
  // è·å–éšè—æ ‡ç­¾çš„viewerå¯¹è±¡
  const viewer = this.$el.querySelector('.images').$viewer
  // æ›´æ”¹toolbarå›¾æ ‡
  viewer.toolbar.firstChild.lastChild.style.backgroundImage = 'url('xxxxx')'
  viewer.toolbar.firstChild.lastChild.style.width = '52px'
  viewer.toolbar.firstChild.lastChild.style.height = '51px'
  viewer.toolbar.firstChild.lastChild.style.title = 'æ‰“åˆ†'

  // éå†ä¿®æ”¹æŒ‰é’®å°ºå¯¸
  let size =  9
  for (let i = 0; i < size; i++) {
    viewer.toolbar.children[0].firstChild.parentElement.children[i].style.width = '52px'
    viewer.toolbar.children[0].firstChild.parentElement.children[i].style.height = '51px'
    viewer.toolbar.children[0].firstChild.parentElement.children[i].style.padding = '13px'
  }

	// ä½¿ç”¨viewæ–¹æ³•æŒ‡å®šè¿›å…¥çš„ç¬¬ä¸€å¼ å›¾ç‰‡
  if (this.pictures[index] == undefined) {
    viewer.view(0)
    this.handleViewerScoreStatus(this.pictures[0].photoId)
    this.viewerPhotoId = this.pictures[0].photoId
  } else {
    this.handleViewerScoreStatus(this.pictures[index].photoId)
    this.viewerPhotoId = this.pictures[index].photoId
    viewer.view(index)
  }
  // æ‰“å¼€viewer
  viewer.show()
},
  
// viewer ä¸Šä¸€å¼ ç›‘å¬
handleViewerPrev() {
  	// è·å–åˆ°å®ä¾‹ï¼Œå¹¶å¯ä»¥é€šè¿‡å®ä¾‹çš„indexå±æ€§è·å–å½“å‰æ˜¾ç¤ºå›¾ç‰‡çš„indexä¸‹æ ‡
    const viewer = this.$el.querySelector('.images').$viewer
    let index = viewer.index
    // æ‰‹åŠ¨å®ç°å›¾ç‰‡ä¸Šä¸€å¼ åˆ‡æ¢
    viewer.view(index - 1)

    // æ‰“åˆ†æŒ‰é’®å¤„ç†
    const photoId = this.pictures[viewer.index].photoId
    this.viewerPhotoId = photoId
    this.handleViewerScoreStatus(photoId)
},
// viewer ä¸‹ä¸€å¼ ç›‘å¬
handleViewerNext() {
    const viewer = this.$el.querySelector('.images').$viewer
    let index = viewer.index
    // æ‰‹åŠ¨å®ç°å›¾ç‰‡ä¸‹ä¸€å¼ åˆ‡æ¢
    viewer.view(index + 1)

    // æ‰“åˆ†æŒ‰é’®å¤„ç†
    const photoId = this.pictures[viewer.index].photoId
    this.viewerPhotoId = photoId
    this.handleViewerScoreStatus(photoId)
}
```

#### 2.ç‚¹å‡»imgè¿›å…¥

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç‚¹å‡»å›¾ç‰‡åä¼šè‡ªåŠ¨è¿›å…¥vieweré¢„è§ˆç•Œé¢ï¼Œè€Œæ— éœ€ä»»ä½•å¤„ç†ï¼Œå·¥å…·æ æŒ‰é’®çš„è‡ªå®šä¹‰ä¸ç›‘å¬æ–¹æ³•ä¸ç¬¬ä¸€ç§æ–¹å¼ç›¸åŒã€‚

```html
<!-- éšè— å¤§å›¾æ¨¡å¼ä½¿ç”¨ è®¾ç½®v-vieweråï¼Œè¯¥å…ƒç´ ä¸‹çš„æ‰€æœ‰imgå…ƒç´ éƒ½ä¼šè¢«viewerè‡ªåŠ¨å¤„ç† -->
<div class="images" id="image" v-viewer >
    <div v-for="photo in pictures" data-photoid="photo.photoId">
      <img :src="photo.response.url" >
    </div>
</div>
```

